<div class="modal fade" id="modal_deposit" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><%= t('dashboard.index.entrust') %></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <i class="las la-times"></i>
        </button>
      </div>
      <form id="form_deposit">
        <div class="modal-body">
          <div class="form-group">
            <label><%= t('dashboard.index.amount') %></label>
            <div class="input-group">
              <input id="modal_deposit_amount" type="number" class="form-control" placeholder="0.00" min="0.000001" step="0.000001" required>
              <div class="input-group-append">
                <span class="input-group-text">USDT</span>
              </div>
            </div>
            <span class="font-12 text-muted m-t-5"><%= t('dashboard.index.current_balance') %></span>
            <span id="modal_deposit_balance" class="font-12 text-muted float-right m-t-5">- USDT</span>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary btn-block btn-rounded ladda-button" data-style="zoom-in"><%= t('tips.confirm') %></button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="modal_withdraw" tabindex="-1" role="dialog" aria-hidden="true" data-backdrop="static">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><%= t('dashboard.index.withdraw') %></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <i class="las la-times"></i>
        </button>
      </div>
      <form id="form_withdraw">
        <div class="modal-body">
          <div class="form-group">
            <label>选择币种</label>
            <select class="form-control" required>
              <option value="usdt">USDT</option>
              <option value="cic">CIC</option>
            </select>
          </div>
          <div class="form-group">
            <label>提取金额</label>
            <div class="input-group">
              <input type="number" class="form-control" placeholder="0.00" min="0.000001" required>
              <div class="input-group-append">
                <span class="input-group-text">USDT</span>
              </div>
            </div>
            <span class="font-12 text-muted m-t-5">可提金额</span>
            <span class="font-12 text-muted float-right m-t-5">1203.123456 USDT</span>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary btn-block btn-rounded ladda-button" data-style="zoom-in">提交</button>
        </div>
      </form>
    </div>
  </div>
</div>


<div class="modal fade" id="modal_transfer" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">划转</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <i class="las la-times"></i>
        </button>
      </div>
      <form id="form_transfer">
        <div class="modal-body">
          <div class="form-group">
            <label>选择币种</label>
            <select class="form-control" required>
              <option value="usdt">USDT</option>
              <option value="cic">CIC</option>
            </select>
          </div>
          <div class="form-group">
            <label>转出账户</label>
            <select class="form-control" required>
              <option value="packet">红包账户</option>
              <option value="wallet">钱包账户</option>
            </select>
          </div>
          <div class="form-group">
            <label>转入账户</label>
            <input type="text" class="form-control" value="钱包账户" disabled>
          </div>
          <div class="form-group">
            <label>金额</label>
            <div class="input-group">
              <input type="number" class="form-control" placeholder="0.00" min="0.000001" required>
              <div class="input-group-append">
                <span class="input-group-text">USDT</span>
              </div>
            </div>
            <span class="font-12 text-muted m-t-5">转出账户余额</span>
            <span class="font-12 text-muted float-right m-t-5">1203.123456 USDT</span>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary btn-block btn-rounded ladda-button" data-style="zoom-in">提交</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
    function show_deposit_modal() {
        contract_usdt.methods.balanceOf(address).call().then(function (result) {
            $('#modal_deposit_balance').text(Contracts.usdt.to_display_amount(result) + ' USDT');
            $('#form_deposit')[0].reset();
            $('#modal_deposit').modal('show');
        }).catch(function (err) {
            swal('<%= t('errors.error') %>', err, 'error');
        });
    }

    function show_withdraw_modal() {
        $('#form_withdraw')[0].reset();
        $('#modal_withdraw').modal('show');
    }

    function show_transfer_modal() {
        $('#form_transfer')[0].reset();
        $('#modal_transfer').modal('show');
    }

    $(function () {
        $('#form_deposit').submit(function () {
            let l = $('#form_deposit button[type="submit"]').ladda();
            l.ladda('start');
            let amount = $('#modal_deposit_amount').val().trim();
            contract_usdt.methods.transfer(Contracts.game.address, Contracts.usdt.to_real_amount(amount)).send({from: address}).then(function (result) {
                Business.post(
                    '/deposits/create', {tx_hash: result.transactionHash, authenticity_token: '<%= form_authenticity_token %>'},
                    function () {
                        l.ladda('stop');
                        $('#modal_deposit').modal('hide');
                        swal('<%= t('tips.success') %>', '<%= t('dashboard.index.entrust_successfully') %>', 'success');
                    }, function (err) {
                        l.ladda('stop');
                        swal('<%= t('errors.error') %>', err.msg, 'error');
                    }
                );
            }).catch(function (err) {
                l.ladda('stop');
                swal('<%= t('errors.error') %>', err.message, 'error');
            });

            return false;
        });
    });
</script>